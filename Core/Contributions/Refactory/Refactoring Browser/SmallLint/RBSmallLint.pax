| package |
package := Package name: 'RBSmallLint'.
package paxVersion: 2;
	preDeclareClassesOnLoad: false;
	basicComment: 'Refactoring Browser SmallLint
Copyright (c) John Brant & Don Roberts.'.


package setClassNames: #(
	#{BasicLintRule}
	#{BlockLintRule}
	#{CompositeLintRule}
	#{LintRule}
	#{MultiEnvironment}
	#{ParseTreeEnvironment}
	#{ParseTreeLintRule}
	#{SmalllintChecker}
	#{SmalllintContext}
	#{SmalllintFilterEnvironment}
	#{TransformationRule}
).

package setMethodNames: #(
	#(#{Behavior} #instanceBehavior)
	#(#{CompiledCode} #needsHybridFrame)
	#(#{CompiledCode} #withAllBlockMethodsDo:)
	#(#{CompiledMethod} #equivalentTo:)
	#(#{Metaclass} #instanceBehavior)
).

package setPrerequisites: #(
	'..\..\..\..\Object Arts\Dolphin\Base\Dolphin'
	'..\Change Objects\RBChangeObjects'
	'..\Environments\RBEnvironments'
	'..\Parser\RBParser'
	'..\Refactorings\RBRefactorings'
).

package!

"Class Definitions"!

Object subclass: #LintRule
	instanceVariableNames: 'name'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
Object subclass: #SmalllintChecker
	instanceVariableNames: 'rule environment context methodBlock'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
Object subclass: #SmalllintContext
	instanceVariableNames: 'class selector parseTree literals literalSemaphore literalProcess selectors compiledMethod selfMessages superMessages messages'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
BrowserEnvironmentWrapper subclass: #MultiEnvironment
	instanceVariableNames: 'environmentDictionaries'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
AndEnvironment subclass: #SmalllintFilterEnvironment
	instanceVariableNames: 'lintRuleName'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
SelectorEnvironment subclass: #ParseTreeEnvironment
	instanceVariableNames: 'matcher'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
LintRule subclass: #BasicLintRule
	instanceVariableNames: 'result openSymbol'
	classVariableNames: 'FilterDictionary'
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
LintRule subclass: #CompositeLintRule
	instanceVariableNames: 'rules'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
LintRule subclass: #TransformationRule
	instanceVariableNames: 'rewriteRule changes class'
	classVariableNames: 'RecursiveSelfRule'
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
BasicLintRule subclass: #BlockLintRule
	instanceVariableNames: 'classBlock methodBlock'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!
BasicLintRule subclass: #ParseTreeLintRule
	instanceVariableNames: 'matcher'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''
	classConstants: {}!

"Loose Methods"!

!Behavior methodsFor!

instanceBehavior
	"Answer the receiver's singleton instance (the actual class object)."

	^self! !
!Behavior categoriesFor: #instanceBehavior!accessing!public! !

!CompiledCode methodsFor!

needsHybridFrame
	^self needsContext!

withAllBlockMethodsDo: operation
	operation value: self! !
!CompiledCode categoriesFor: #needsHybridFrame!private!testing! !
!CompiledCode categoriesFor: #withAllBlockMethodsDo:!enumerating!private! !

!CompiledMethod methodsFor!

equivalentTo: aCompiledMethod
	| selfParseTree source |
	#rbFix.	"Use the VisualAge version which doesn't include a Decompiler either"
	self class == aCompiledMethod class ifFalse: [^false].
	self byteCodes = aCompiledMethod byteCodes ifFalse: [^false].
	#rbSW.	"Added literals check to stop false positives when using ##()"
	self literals = aCompiledMethod literals ifFalse: [^false].
	source := self getSource.
	source isNil ifTrue: [^false].
	selfParseTree := RBParser parseMethod: source onError: [:string :pos | ^false].
	source := aCompiledMethod getSource.
	source isNil ifTrue: [^false].
	^selfParseTree equalTo: (RBParser parseMethod: source onError: [:string :pos | ^false])
		exceptForVariables: #()
	"
	^self = aCompiledMethod or: [self class == aCompiledMethod class and: [self numArgs == aCompiledMethod numArgs
				and: 
					[| selfParseTree methodParseTree |
					selfParseTree := mclass decompilerClass new
								decompile: (mclass defaultSelectorForMethod: self)
								in: mclass
								method: self.
					methodParseTree := aCompiledMethod mclass decompilerClass new
								decompile: (aCompiledMethod mclass defaultSelectorForMethod: aCompiledMethod)
								in: aCompiledMethod mclass
								method: aCompiledMethod.
					selfParseTree = methodParseTree]]]"! !
!CompiledMethod categoriesFor: #equivalentTo:!public!RefactoringBrowser! !

!Metaclass methodsFor!

instanceBehavior
	"Answer the receiver's singleton instance (the actual class object)."

	^instanceClass! !
!Metaclass categoriesFor: #instanceBehavior!accessing!public! !

"End of package definition"!

